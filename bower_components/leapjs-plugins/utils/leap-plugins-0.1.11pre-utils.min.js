/*    
 * LeapJS-Plugins Extra - v0.1.11pre - 2015-04-08    
 * http://github.com/leapmotion/leapjs-plugins/    
 *    
 * Copyright 2015 LeapMotion, Inc    
 *    
 * Licensed under the Apache License, Version 2.0 (the "License");    
 * you may not use this file except in compliance with the License.    
 * You may obtain a copy of the License at    
 *    
 *     http://www.apache.org/licenses/LICENSE-2.0    
 *    
 * Unless required by applicable law or agreed to in writing, software    
 * distributed under the License is distributed on an "AS IS" BASIS,    
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.    
 * See the License for the specific language governing permissions and    
 * limitations under the License.    
 *    
 */    
function appendrot(a,b,c){var d,e;return e=a.length,2>e?a:(d=mkgivens(e,b,c),mmult(a,d))}function copy(a){var b,c,d;for(d=[],b=0;b<a.length;b++)for(d[b]=[],c=0;c<a[b].length;c++)d[b][c]=a[b][c];return d}function exact(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;return b=a[0][0],c=a[0][1],d=a[1][1],g=(b+d)/2,h=(b-d)/2,i=Math.sqrt(c*c+h*h),e=g+i,f=g-i,j=[[e,0],[0,f]],b-=e,l=1,m=b/c,n=Math.sqrt(l*l+m*m),l/=n,m/=n,k=[[l,m],[-m,l]],{vals:j,vect:k}}function findangle(a,b){var c,d,e,f,g,h,i,j,k,l,m;return c=a[b.i][b.i],d=a[b.i][b.j],e=a[b.j][b.i],f=a[b.j][b.j],e!==d?0:(h=(c+f)/2,i=(c-f)/2,j=Math.sqrt(e*e+i*i),g=h+j,muminus=h-j,c-=g,k=1,l=c/d,m=Math.sqrt(k*k+l*l),k/=m,l/=m,{cos:k,sin:-l})}function findij(a){var b,c,d,e,f,g;if(b=a.length,2>b)return void 0;for(e=a[0][1],f=0,g=1,c=0;b>c;c++)for(d=0;c>d;d++)Math.abs(a[d][c])>Math.abs(e)&&(e=a[d][c],f=d,g=c);return{i:f,j:g}}function ident(a){var b,c,d;for(d=[],b=0;a>b;b++)for(d[b]=[],c=0;a>c;c++)d[b][c]=b===c?1:0;return d}function mkgivens(a,b,c){var d;return d=ident(a),d[b.i][b.i]=c.cos,d[b.i][b.j]=-c.sin,d[b.j][b.j]=c.cos,d[b.j][b.i]=c.sin,d}function offd(a){var b,c,d,e;for(c=a.length,b=0,d=0;c>d;d++)for(e=0;c>e;e++)d!==e&&(b+=a[d][e]*a[d][e]);return b}function optimistf(a,b){var c,d,e;return d=a.length,c=offd(a),e=b/(2*d-1),1/(d-1)*e*e>c}function ln(a){return Math.log(a)}function pessimistf(a,b){var c,d,e,f;return c=a.length,d=offd(a),f=c*c-c,e=(ln(d)+ln(c-1)-2*ln(b)+2*ln(2*c-1))/(ln(f)-ln(f-2)),e=Math.ceil(e)}function repair(a){var b,c,d,e;for(b=a.length,e=[],d=0;b>d;d++)for(c=0;d>c;c++)e[c]||(e[c]=[]),e[d]||(e[d]=[]),e[c][d]=a[c][d],e[d][c]=a[c][d];for(c=0;b>c;c++)e[c][c]=a[c][c];return e}function rotate(a,b,c){var d,e;return d=a.length,2>d?a:(e=mkgivens(d,b,c),mmult(mmult(transpose(e),a),e))}function jae(a,b){var c,d,e,f,g,h,i;if(assert(a),assert(void 0!==b),c=a.rows,1===c)return a;if(2===c)return exact(a);for(d=copy(a),e=ident(c),i=pessimistf(a,b);i-->0&&(f=findij(d),g=findangle(d,f),d=rotate(d,f,g),e=appendrot(e,f,g),d=repair(d),!optimistf(d,b)););return h={vals:d,vect:e}}function init(a){a.dp?(a.rfn="readDoubleBE",a.wfn="writeDoubleBE",a.bpv=8):(a.rfn="readFloatBE",a.wfn="writeFloatBE",a.bpv=4),a.buf||(a.buf=new Buffer(a.rows*a.cols*a.bpv)),a.stride=[a.cols,1]}function float2dm(a,b,c){assert(a),assert(b),this.rows=a,this.cols=b,this.dp=c}function mmult(a,b){var c,d,e,f,g,h,i;for(d=a.length,e=b.length,f=b[0].length,c=[],g=0;d>g;g++)for(h=0;f>h;h++)for(c[g]||(c[g]=[]),c[g][h]=0,i=0;e>i;i++)c[g][h]+=a[g][i]*b[i][h];return c}function transpose(a){var b,c,d,e,f;for(b=[],c=a.length,d=a[0].length,f=0;d>f;f++)for(e=0;c>e;e++)b[f]||(b[f]=[]),b[f][e]=a[e][f];return b}var mkgivens=require("./mkgivens"),mmult=require("mmult");module.exports=appendrot,module.exports=copy,module.exports=exact;var assert=require("assert");module.exports=findangle,module.exports=findij,module.exports=ident;var ident=require("./ident");module.exports=mkgivens,module.exports=offd;var offd=require("./offd");module.exports=optimistf;var offd=require("./offd");module.exports=pessimistf,module.exports=repair;var mmult=require("mmult"),transpose=require("transpose"),ident=require("./ident"),mkgivens=require("./mkgivens");module.exports=rotate;var test=require("taptap"),assert=require("assert"),appendrot=require("../appendrot");test(function(a){var b,c,d;b=[[1,0],[0,1]],c={i:0,j:1},d={cos:100,sin:-100},assert.deepEqual(appendrot(b,c,d),[[100,100],[-100,100]]),a()}),test(function(a){var b,c,d;b=[[1,0,0],[0,1,0],[0,0,1]],c={i:0,j:2},d={cos:100,sin:-100},assert.deepEqual(appendrot(b,c,d),[[100,0,100],[0,1,0],[-100,0,100]]),a()});var test=require("taptap"),assert=require("assert"),copy=require("../copy");test(function(a){var b=[[1,2,3],[4,5,6],[7,8,9]];assert.equal(b,b),assert.deepEqual(copy(b),b),assert.notEqual(copy(b),b),a()});var test=require("taptap"),assert=require("assert"),exact=require("../exact");test(function(a){assert.deepEqual(exact([[1,2],[2,4]]),{vals:[[5,0],[0,0]],vect:[[1/Math.sqrt(5),-2/Math.sqrt(5)],[2/Math.sqrt(5),1/Math.sqrt(5)]]}),a()}),test.skip(function(a){assert.deepEqual(exact([[2,3],[3,1]]),{vals:[[4.5413,0],[0,-1.5413]],vect:[[.763,-.64636286],[.64636286,.763]]}),a()});var test=require("taptap"),assert=require("assert"),findangle=require("../findangle");test(function(a){var b=[[3,2],[2,6]],c={i:0,j:1};assert.deepEqual(findangle(b,c),{cos:1/Math.sqrt(5),sin:2/Math.sqrt(5)}),a()}),test(function(a){var b=[[1,2],[2,4]],c={i:0,j:1};assert.deepEqual(findangle(b,c),{cos:1/Math.sqrt(5),sin:2/Math.sqrt(5)}),a()}),test(function(a){var b=[[1,1e-31],[0,4]],c={i:0,j:1};assert.deepEqual(findangle(b,c),0),a()}),test("5x5",function(a){var b=[[1,0,0,0,0],[0,1,2,0,0],[3,2,4,0,0],[4,1,9,3,4],[1,2,4,0,3]],c={i:1,j:2};assert.deepEqual(findangle(b,c),{cos:1/Math.sqrt(5),sin:2/Math.sqrt(5)}),a()});var test=require("taptap"),assert=require("assert"),findij=require("../findij");test(function(a){assert.equal(findij([[1]]),void 0),a()}),test(function(a){assert.deepEqual(findij([[1,2],[3,4]]),{i:0,j:1}),a()}),test(function(a){assert.deepEqual(findij([[1,-.1,0],[-.1,1,0],[0,0,1]]),{i:0,j:1}),a()}),test(function(a){assert.deepEqual(findij([[1,2,4,6],[3,4,5,1],[1,5,6,3],[7,1,8,1]]),{i:0,j:3}),a()});var test=require("taptap"),assert=require("assert"),ident=require("../ident");test(function(a){assert.deepEqual(ident(1),[[1]]),a()}),test(function(a){assert.deepEqual(ident(2),[[1,0],[0,1]]),a()}),test(function(a){assert.deepEqual(ident(4),[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]),a()});var test=require("taptap"),assert=require("assert"),mkgivens=require("../mkgivens");test(function(a){var b,c,d;b={cos:100,sin:-100},c={i:0,j:1},d=mkgivens(2,c,b),assert.deepEqual(d,[[100,100],[-100,100]]),a()}),test(function(a){var b,c,d;b={cos:100,sin:-100},c={i:0,j:2},d=mkgivens(3,c,b),assert.deepEqual(d,[[100,0,100],[0,1,0],[-100,0,100]]),a()});var test=require("taptap"),assert=require("assert"),offd=require("../offd");test(function(a){var b;b=[[2,3],[4,5]],assert.equal(offd(b),25),a()}),test(function(a){var b;b=[[2,3,1],[4,5,1],[1,1,0]],assert.equal(offd(b),29),a()});var test=require("taptap"),assert=require("assert"),optimistf=require("../optimistf");test(function(a){var b;b=[[2,100],[100,1]],assert.equal(optimistf(b,.1),!1),a()}),test(function(a){var b;b=[[2,.1],[.1,1]],assert.equal(optimistf(b,100),!0),a()}),test(function(a){var b;b=[[2,.02],[.02,1]],assert.equal(optimistf(b,.1),!0),a()}),test(function(a){var b;b=[[2,.03],[.02,1]],assert.equal(optimistf(b,.1),!1),a()});var test=require("taptap"),assert=require("assert"),pessimistf=require("../pessimistf");test(function(a){var b;b=[[1,20],[20,3]],assert.equal(pessimistf(b,.1),0),a()}),test(function(a){var b;b=[[1,2,3],[2,4,5],[3,5,6]],assert.equal(pessimistf(b,.01),44),a()}),test(function(a){var b;b=[[1,2,3],[2,4,5],[3,5,6]],assert.equal(pessimistf(b,100),-2),a()}),test(function(a){var b;b=[[1,1e-4,1e-4],[1e-4,2,1e-4],[1e-4,1e-4,3]],assert.equal(pessimistf(b,.01),-8),a()});var test=require("taptap"),assert=require("assert"),repair=require("../repair");test(function(a){var b;b=[[1,3,5],[3,2,0],[5,0,4]],assert.notEqual(repair(b),b),assert.deepEqual(repair(b),b),a()}),test(function(a){var b;b=[[1,1e-10,0],[0,1e4,0],[0,0,1]],assert.deepEqual(repair(b),[[1,1e-10,0],[1e-10,1e4,0],[0,0,1]]),a()}),test(function(a){var b;b=[[1,1e-16],[0,2]],assert.deepEqual(repair(b),[[1,1e-16],[1e-16,2]]),a()});var test=require("taptap"),assert=require("assert"),rotate=require("../rotate");test(function(a){var b=[[1]],c={i:0,j:0},d={cos:Math.cos(Math.PI/2),sin:Math.sin(Math.PI/2)};assert.equal(rotate(b,c,d),b),a()}),test.skip(function(a){var b=[[2,1,1],[1,2,1],[1,1,2]],c={i:0,j:1},d={cos:1/Math.sqrt(2),sin:1/Math.sqrt(2)},e=[[3,0,Math.sqrt(2)],[0,1,0],[Math.sqrt(2),0,2]];assert.deepEqual(rotate(b,c,d),e),a()}),test.skip(function(a){var b=[[3,0,Math.sqrt(2)],[0,1,0],[Math.sqrt(2),0,2]],c={i:0,j:2},d={cos:Math.sqrt(2/3),sin:Math.sqrt(1/3)},e=[[4,0,0],[0,1,0],[0,0,1]];assert.deepEqual(rotate(b,c,d),e),a()});var assert=require("assert"),copy=require("./fn/copy"),findangle=require("./fn/findangle"),findij=require("./fn/findij"),rotate=require("./fn/rotate"),ident=require("./fn/ident"),appendrot=require("./fn/appendrot"),pessimistf=require("./fn/pessimistf"),optimistf=require("./fn/optimistf"),repair=require("./fn/repair"),exact=require("./fn/exact");module.exports=jae;var assert=require("assert");float2dm.prototype.get=function(a,b){var c;return this.buf||init(this),c=(a*this.stride[0]+b*this.stride[1])*this.bpv,this.buf[this.rfn](c)},float2dm.prototype.set=function(a,b,c){var d;this.buf||init(this),d=(a*this.stride[0]+b*this.stride[1])*this.bpv,this.buf[this.wfn](c,d)},float2dm.prototype.tr=function(){var a;return this.buf||init(this),a=new float2dm(this.rows,this.cols,this.dp),a.buf=this.buf,init(a),a.stride=[this.stride[1],this.stride[0]],a},module.exports=float2dm;var test=require("taptap"),assert=require("assert"),matrix=require("../index");test(function(a){var b;b=new matrix(2,3),assert.equal(b.buf,void 0),assert.equal(b.rfn,void 0),assert.equal(b.wfn,void 0),b.set(0,0,1.3),assert(b.buf.length,24),assert.equal(b.rfn,"readFloatBE"),assert.equal(b.wfn,"writeFloatBE"),b.set(0,1,2),b.set(0,2,3.51),b.set(1,0,33.18),b.set(1,1,35),b.set(1,2,11),assert.equal(b.get(0,1),2),assert.equal(b.get(1,1),35),assert.equal(b.get(1,2),11),a()}),test(function(a){var b;b=new matrix(2,3,1),assert.equal(b.buf,void 0),assert.equal(b.rfn,void 0),assert.equal(b.wfn,void 0),b.set(0,0,1.3),assert(b.buf.length,48),assert.equal(b.rfn,"readDoubleBE"),assert.equal(b.wfn,"writeDoubleBE"),b.set(0,1,2),b.set(0,2,3.51),b.set(1,0,33.18),b.set(1,1,35),b.set(1,2,11),assert.equal(b.get(0,0),1.3),assert.equal(b.get(0,1),2),assert.equal(b.get(0,2),3.51),assert.equal(b.get(1,0),33.18),assert.equal(b.get(1,1),35),assert.equal(b.get(1,2),11),a()}),test(function(a){var b;b=new matrix(2,3,1),assert.equal(b.buf,void 0),b=b.tr(),assert.equal(b.buf.length,48),b.set(0,0,1.3),b.set(0,1,33.18),b.set(1,0,2),b.set(1,1,35),b.set(2,0,3.51),b.set(2,1,11),b=b.tr(),assert.equal(b.get(0,0),1.3),assert.equal(b.get(0,1),2),assert.equal(b.get(0,2),3.51),assert.equal(b.get(1,0),33.18),assert.equal(b.get(1,1),35),assert.equal(b.get(1,2),11),a()}),test(function(a){var b;b=new matrix(2,3,1),b=b.tr(),b.set(0,0,1.3),b.set(0,1,33.18),b.set(1,0,2),b.set(1,1,35),b.set(2,0,3.51),b.set(2,1,11),assert.equal(b.get(0,0),1.3),assert.equal(b.get(0,1),33.18),assert.equal(b.get(1,0),2),assert.equal(b.get(1,1),35),assert.equal(b.get(2,0),3.51),assert.equal(b.get(2,1),11),a()});var test=require("taptap"),assert=require("assert"),jea=require("../index"),fmatrix=require("float2dm"),mmult=require("mmult"),transpose=require("transpose");test(function(a){var b,c,d,e;b=new fmatrix(2,2),b.set(0,0,3),b.set(0,1,2),b.set(1,0,2),b.set(1,1,6),c=jea(b,0),d=c.vals,e=c.vect,assert.equal(d.get(0,0),7),assert.equal(d.get(0,1),0),assert.equal(d.get(1,0),0),assert.equal(d.get(1,1),2),assert.equal(e.get(0,0),1/Math.sqrt(5)),assert.equal(e.get(0,1),-2/Math.sqrt(5)),assert.equal(e.get(1,0),2/Math.sqrt(5)),assert.equal(e.get(1,1),1/Math.sqrt(5)),a()}),test(function(a){var b,c,d,e;b=new fmatrix(2,2),b.set(0,0,1),b.set(0,1,2),b.set(1,0,2),b.set(1,1,4),c=jea(b,0),d=c.vals,e=c.vect,assert.equal(d.get(0,0),5),assert.equal(d.get(0,1),0),assert.equal(d.get(1,0),0),assert.equal(d.get(1,1),0),assert.equal(e.get(0,0),1/Math.sqrt(5)),assert.equal(e.get(0,1),-2/Math.sqrt(5)),assert.equal(e.get(1,0),2/Math.sqrt(5)),assert.equal(e.get(1,1),1/Math.sqrt(5)),a()}),test.skip(function(a){var b,c,d,e,f,g;b=new fmatrix(2,2),b.set(0,0,1),b.set(0,1,2),b.set(1,0,2),b.set(1,1,5),d=(-2-2*Math.sqrt(2))/2,c=1+Math.pow(d,2),c=Math.sqrt(c),e=jea(b,0),f=e.vals,g=e.vect,assert.equal(f.get(0,0),3+2*Math.sqrt(2)),assert.equal(f.get(0,1),0),assert.equal(f.get(1,0),0),assert.equal(f.get(1,1),3-2*Math.sqrt(2)),assert.equal(g.get(0,0),1/c),assert.equal(g.get(0,1),d/c),assert.equal(g.get(1,0),-d/c),assert.equal(g.get(1,1),1/c),a()}),test.skip(function(a){var b;b=new fmatrix(2,2),b.set(0,0,1),b.set(0,1,2),b.set(1,0,2),b.set(1,1,5),b=[[2,1,1],[1,2,1],[1,1,2]],assert.deepEqual(jea(b,.1),{vals:[[4,0,0],[0,1,0],[0,0,1]],vect:mmult([[1/Math.sqrt(2),-1/Math.sqrt(2),0],[1/Math.sqrt(2),1/Math.sqrt(2),0],[0,0,1]],[[Math.sqrt(2/3),0,-Math.sqrt(1/3)],[0,1,0],[Math.sqrt(1/3),0,Math.sqrt(2/3)]])}),a()}),test.skip(function(a){var b,c;b=[[2,-4,1],[-4,5,-1],[1,-1,2]],c=[[8.08996,.00555,-.05593],[.00555,1.70646,0],[-.05593,0,-.79642]],assert.deepEqual(jea(b,1.4).vals,c),assert.deepEqual(mmult(mmult(transpose(jea(b,1.4).vect),b),jea(b,1.4).vect),c),a()}),module.exports=mmult;var assert=require("assert"),mmult=require("../index");describe("mmult multiplies two matrices",function(){it("1x1, 1x2",function(a){var b=[[1]],c=[[3,4]];assert.deepEqual(mmult(b,c),c),assert.notEqual(mmult(b,c),c),a()}),it("4x2, 2x3",function(a){var b=[[4,2],[4,2],[4,2],[4,2]],c=[[1,2,3],[4,5,6]],d=[[12,18,24],[12,18,24],[12,18,24],[12,18,24]];assert.deepEqual(mmult(b,c),d),a()})}),module.exports=transpose;var test=require("test"),assert=require("assert"),transpose=require("../index");it(function(a){assert.deepEqual(transpose([[1]]),[[1]]),a()}),it(function(a){assert.deepEqual(transpose([[1,2],[3,4]]),[[1,3],[2,4]]),a()}),it(function(a){assert.deepEqual(transpose([[1,2,3,4],[2,3,4,5],[8,4,5,6],[4,5,6,7]]),[[1,2,8,4],[2,3,4,5],[3,4,5,6],[4,5,6,7]]),a()}),function(a,b){"function"==typeof define&&define.amd?define([],b):a.LeapDataPlotter=b()}(this,function(){var a,b,c=["#900","#090","#009","#990","#909","#099"],d=0;return a=function(a){this.options=a||(a={}),this.seriesHash={},this.series=[],this.init(a.el)},a.prototype.init=function(a){if(a)var b=a;else{var b=document.createElement("canvas");b.className="leap-data-plotter",document.body.appendChild(b)}this.canvas=b,this.context=b.getContext("2d"),this.rescale()},a.prototype.rescale=function(){var a=getComputedStyle(this.canvas),b=parseInt(a.width,10),c=parseInt(a.height,10);this.width=b,this.height=c;var d=window.devicePixelRatio||1,e=this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1,f=d/e;if(d!==e){var g=this.canvas.width,h=this.canvas.height;this.canvas.width=g*f,this.canvas.height=h*f,this.canvas.style.width=g+"px",this.canvas.style.height=h+"px",this.context.scale(f,f)}this.clear(),this.draw()},a.prototype.plot=function(a,b,c){if(c||(c={}),b.length)for(var d=0,e=120;d<b.length;d++,e=++e>122?97:e)this.getTimeSeries(a+"."+String.fromCharCode(e),c).push(b[d],{pointColor:c.pointColor});else this.getTimeSeries(a,c).push(b,{pointColor:c.pointColor})},a.prototype.getTimeSeries=function(a,c){var d=this.seriesHash[a];if(!d){var e=this.getOptions(a);for(key in c)e[key]=c[key];d=new b(e),this.series.push(d),this.seriesHash[a]=d}return d},a.prototype.getOptions=function(a){var b=d;d=(d+1)%c.length;var e=this.series.length,f=e?this.series[e-1].y+50:0;return{y:f,width:this.width,color:c[b],name:a}},a.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},a.prototype.draw=function(){var a=this.context;this.series.forEach(function(b){b.draw(a)})},a.prototype.update=function(){this.clear(),this.draw()},b=function(a){a=a||{},this.x=a.x||0,this.y=a.y||0,this.precision=a.precision||5,this.units=a.units||"",this.width=a.width||1e3,this.height=a.height||50,this.length=a.length||600,this.color=a.color||"#000",this.name=a.name||"",this.frameHandler=a.frameHandler,this.max=-1/0,this.min=1/0,this.data=[],this.pointColors=[]},b.prototype.push=function(a,b){return this.data.push(a),this.data.length>=this.length&&this.data.shift(),b&&b.pointColor&&(this.pointColors.push(b.pointColor),this.pointColors.length>=this.length&&this.pointColors.shift()),this},b.prototype.draw=function(a){var b=this,c=(this.width-10)/(this.length-1),d=-(this.height-10)/(this.max-this.min),e=5,f=(this.max-this.min)*d+10;a.save(),a.strokeRect(this.x,this.y,this.width,this.height),a.translate(this.x,this.y+this.height-e),a.strokeStyle=this.color,a.beginPath();var g=-1/0,h=1/0;this.data.forEach(function(e,f){e>g&&(g=e),h>e&&(h=e),isNaN(e)?(a.stroke(),a.beginPath()):(a.lineTo(f*c,(e-b.min)*d),b.pointColors[f]&&b.pointColors[f]!=b.pointColors[f-1]&&(a.stroke(),a.strokeStyle=b.pointColors[f],a.beginPath(),a.lineTo(f*c,(e-b.min)*d)))}),a.stroke(),a.fillText(this.name,e,f),a.fillText(this.data[this.data.length-1].toPrecision(this.precision)+this.units,e,0),a.textAlign="end",a.fillText(this.min.toPrecision(this.precision)+this.units,this.width-e,0),a.fillText(this.max.toPrecision(this.precision)+this.units,this.width-e,f),a.textAlign="left",a.restore(),this.min=h,this.max=g},a});